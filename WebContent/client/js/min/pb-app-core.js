function PbAppClient(a,d,c,b){EventWsEndpoint.call(this,a,d,c,b)}PbAppClient.prototype=Object.create(EventWsEndpoint.prototype);PbAppClient.prototype.constructor=PbAppClient;PbAppClient.prototype.doAppInit=function(){this.send({et:"APP:INIT:REQUEST"})};PbAppClient.prototype.refreshSection=function(a){this.send({et:"APP:SECTION:REFRESH_REQUEST",data:a})};PbAppClient.prototype.getDataFieldAllowedValues=function(a){this.send({et:"DATAFIELD:VALUES:GET_ALLOWED",data:a})};PbAppClient.prototype.getEntityDataByHash=function(a){this.send({et:"APP:ENTITY:GET_DATA",data:{hash:a}})};function DataFieldController(a){this.df=a;this.elem;this.dependencies;this.dependees;this.changeListener;this.dataContext;this.showing=true;this.ready=true;this.init()}DataFieldController.prototype=Object.create(DataFieldController.prototype);DataFieldController.prototype.constructor=DataFieldController;DataFieldController.prototype.init=function(){log("Initializing "+this.df.id);var a=this.df.allowedValuesMap;if(a!=null){var c=a.ds.requiredParams;if(c!=null&&c.length>0){log(this.df.id+" has dependencies "+c);this.dependencies={};for(var b in c){this.dependencies[c[b]]=true}log(this.df.id+": added dependencies "+this.dependencies)}}};DataFieldController.prototype.createElement=function(){return $("<input>")};DataFieldController.prototype.getElement=function(a){if(this.elem==null){this.elem=this.createElement();this.dataContext=a;if(this.changeListener!=null){this.setupChangeListener(this.changeListener)}this.refresh(a)}return this.elem};DataFieldController.prototype.refresh=function(a){var b=this.df.displayCondition;var c=this.showing;if(b!=null){this.showing=PB.testCondition(b,a)}else{this.showing=true}if(this.showing){this.update(a);this.elem.parent().parent().show()}else{if(this.elem!=null){this.elem.parent().parent().hide();if(c){this.elem.change()}}}log("refreshed "+this.df.id+" showing="+this.showing)};DataFieldController.prototype.update=function(a){var f=this.df.allowedValuesMap;if(f!=null){var h;var d=f.ds.requiredParams;if(d!=null&&a!=null){h={};var g=f.ds.requiredParamsMap;for(var c in d){var b=d[c];var e=a.getFieldValue(b);if(e==null){continue}if(g!=null&&g[b]!=null){b=g[b]}h[b]=e}}this.ready=false;PB.pbAgent.getDataFieldAllowedValues({dataFieldId:this.df.id,dataSourceId:f.ds.id,params:h})}else{if(this.df.allowedValues!=null||this.df.value!=null){this.populate()}}};DataFieldController.prototype.addDependee=function(b){log("add dependee "+b.df.id+" on "+this.df.id);if(this.dependees==null){this.dependees={}}this.dependees[b.df.id]=b;var a=this;if(this.changeListener==null){var c=function(f){log("change listener called on "+a.df.id);for(var d in a.dependees){log("refreshing dependee "+d);a.dependees[d].refresh(a.dataContext)}};this.setupChangeListener(c)}};DataFieldController.prototype.setupChangeListener=function(a){this.changeListener=a;if(this.elem!=null){log("registering change listener on "+this.df.id);this.elem.change(a)}};DataFieldController.prototype.addChangeListener=function(b){var a=this;this.elem.change(function(c){b(a)})};DataFieldController.prototype.populate=function(a){};DataFieldController.prototype.getUiValue=function(){return this.elem.val()};DataFieldController.prototype.getValueData=function(a){log("get value data for field "+this.df.id+" with value "+a);if(a==null){return null}if(this.df.allowedValues!=null){var b;this.df.allowedValues.forEach(function(c){if(c.id.toString()===a.toString()){b=c;return}});return b}return null};DataFieldController.prototype.buildView=function(a){var e=$("<div>");var f=$("<div>").addClass("datafield-elem");var d=$("<div>").addClass("datafield-elem");var c=$("<div>").addClass("datafield-elem");var b=this.getElement(a);e.append(f);e.append(d);e.append(b);e.append(c);c.hide();if(this.df.desc!=null){f.html(this.df.desc)}if(this.df.info!=null){d.html(this.df.info)}else{d.hide()}this.initUi();return e};function FormDataController(b,a){this.fields={};if(b!=null){this.initFromDataFields(b,a)}}FormDataController.prototype=Object.create(FormDataController.prototype);FormDataController.prototype.constructor=FormDataController;FormDataController.prototype.initFromDataFields=function(c,b){for(var d in c){var g=c[d];if(b!=null&&b[g.id]!=null){g.value=b[g.id]}var a=PB.getDataFieldController(g);if(a==null){log("Error: Failed to create controller for datafield type"+g.inputType)}this.fields[g.id]=a}for(var d in this.fields){var a=this.fields[d];if(a.dependencies!=null){for(var f in a.dependencies){var e=this.fields[f];e.addDependee(a)}}}};FormDataController.prototype.getFieldValue=function(a){log("get field value "+a);var b=this.fields[a];if(b!=null&&b.ready&&b.showing){return b.getUiValue()}return null};FormDataController.prototype.getDataForFieldValue=function(a,c){var b=this.fields[a];log("getDataForFieldValue fieldId="+a+" fc="+b);if(b!=null&&b.ready&&b.showing){return b.getValueData(c)}return null};FormDataController.prototype.onFieldValuesAvailable=function(b){if(b!=null){var a=this.fields[b.dataFieldId];if(a!=null){a.elem.empty();a.populate(b);a.ready=true;a.elem.change()}}};FormDataController.prototype.buildView=function(a,b){for(var d in this.fields){var c=this.fields[d];var g=c.buildView(this);a.append(g)}if(b!=null&&b.length>0){var h=$("<div>").addClass("form-area");for(var i in b){var e=b[i];var f=$("<button>").addClass("datafield-elem");f.html(e.desc);f.click(e.callback);h.append(f)}a.append(h)}return a};var DPARAMS=DPARAMS||{"0":function(b,a){return b.value},"1":function(b,a){return a.getFieldValue(b.id)}};var CONDITIONS=CONDITIONS||{comp:function(d,a){var c=PB.getDparamValue(d.p1,a);var b=PB.getDparamValue(d.p2,a);var e;if(c==b){e=0}else{if(c>b){e=1}else{e=-1}}log("testing "+c+" and "+b+" for expected output "+d.expected+" for context "+a+" with output "+e);log("satisfied: "+d.expected.indexOf(e));return d.expected.indexOf(e)>=0}};var PB=PB||{MODULES:{},VIEWS:{TYPES:{MapAppSection:{page:"harta_merg.html"},UserEntitiesAppSection:{page:"entities_list.html"},AggregatedAppSection:{page:"submenu.html"},StatsAppSection:{page:"generic_stats.html"},UserActionsSection:{page:"actions.html"}},IDS:{harta_sesizari:{page:"harta_sesizari.html"},detalii:{page:"detalii.html"}}},pbAgent:null,sectionController:null,initData:null,logging:false};function log(a){if(PB.logging){console.log(a)}}PB.initModules=function(c){for(var a in PB.MODULES){var b=PB.MODULES[a];if(b.initialized&&b.onAppDataUpdate!=null){b.onAppDataUpdate(c)}else{b.init(c);b.initialized=true}}};PB.getViewTypeConfig=function(a){var b=PB.VIEWS.TYPES[a];return b};PB.getViewTypeConfigById=function(a){var b=PB.VIEWS.IDS[a];return b};PB.refreshCurrentSection=function(a){PB.CONTROLLER.setFilterParams(a,true);var b=PB.sectionController;if(b!=null&&b.refreshSection!=null){b.refreshSection(a)}};PB.handleSectionData=function(b,a){var c=PB.sectionController;if(c!=null&&c.onSectionData!=null){c.onSectionData(b)}else{if(a!=null){a(b)}}};PB.handlePetitionData=function(a){var b=PB.sectionController;log("PB.handlePetitionData called, section controller: "+b);if(b!=null&&b.onPetitionData!=null){b.onPetitionData(a)}};PB.testCondition=function(b,a){var c=CONDITIONS[b.type];if(c!=null){return c(b,a)}return false};PB.filtersListToObject=function(b){var a={};if(b!=null){b.forEach(function(c){a[c.fieldValue.id]=c.fieldValue.value})}return a};PB.getDparamValue=function(c,b){var a=DPARAMS[c.type];if(a!=null){return a(c,b)}return null};PB.dataFieldsToInputs={"0":function(a){var b=new DataFieldController(a);b.createElement=function(d){var c=$("<input>");return c},b.populate=function(c){if(this.df.value!=null){this.elem[0].value=this.df.value}},b.getUiValue=function(){return this.elem.val()};b.initUi=function(){this.elem.parent().addClass("text-style")};return b},"1":function(a){var b=new DataFieldController(a);b.createElement=function(d){var c=$("<select>");return c},b.populate=function(g){var d=this.df.allowedValues;if(g!=null){d=g.allowedValues;this.df.allowedValues=d}if(d!=null){log("populate elem "+this.elem+" for datafiled "+this.df.id+" with value "+this.df.value);for(var e in d){var c=d[e];var f=$("<option value="+c.id+">").html(c.desc);this.elem.append(f)}}if(this.df.value!=null){this.elem[0].value=this.df.value}},b.getUiValue=function(){return this.elem.find(":selected").val()};b.initUi=function(){this.elem.parent().addClass("select-style")};return b},"3":function(a){var b=new DataFieldController(a);b.createElement=function(d){var c=$("<textarea rows='5'>");return c},b.populate=function(c){if(this.df.value!=null){this.elem[0].value=this.df.value}},b.getUiValue=function(){return this.elem.val()};b.initUi=function(){this.elem.parent().addClass("text-style")};return b}};PB.getInputElemetForDataField=function(b){var a=PB.dataFieldsToInputs[b.inputType];if(a!=null){return a(b).getElement()}return null};PB.getDataFieldController=function(b){var a=PB.dataFieldsToInputs[b.inputType];if(a!=null){return a(b)}return null};PB.goHome=function(){var a=PB.initData.defaultSection;if(a==null){a=PB.initData.sections[0].id}log("going home to section "+a);$("#"+a).click()};PB.showInfoMessage=function(b,c){var a=document.getElementById("snackbar");if(a==null){return}a.innerHTML=b;a.classList.add("show");if(c==null){c=3000}setTimeout(function(){a.classList.remove("show")},c)};